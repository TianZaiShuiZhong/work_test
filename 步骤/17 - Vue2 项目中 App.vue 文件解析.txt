17 - Vue2 项目中 App.vue 文件解析

一、引言

在 Vue2 项目中，App.vue 文件是整个应用的根组件，它通常包含了应用的布局结构和一些全局的逻辑。本实验手册将详细介绍 App.vue 文件在 Vue2 项目中的作用和常见的结构及代码解释。

二、App.vue 的一般结构

通常，App.vue 文件包含三个主要部分：<template>、<script> 和 <style>。
1. <template>：定义了组件的 HTML 结构。
2. <script>：包含组件的 JavaScript 逻辑，如数据、方法、生命周期钩子等。
3. <style>：用于定义组件的样式。

三、代码解释

以下是一个简单的 App.vue 文件示例：
<template>
  <div id="app">
    <router-view/>
  </div>
</template>

<script>
export default {
  name: 'App',
  data() {
    return {
      // 这里可以定义组件的数据
    };
  },
  methods: {
    // 这里可以定义组件的方法
  },
  mounted() {
    // 这里可以定义组件的生命周期钩子函数
  }
};
</script>

<style>
/* 这里可以定义组件的样式 */
</style>


1. <template> 部分

• <div id="app">：这是根元素，通常用于设置组件的容器。id="app" 是 Vue 应用的默认挂载点，与 main.js 中 new Vue({ el: '#app' }) 对应。

• <router-view/>：这是一个特殊的标签，用于显示由 Vue Router 管理的路由组件。当用户导航到不同的路由时，对应的组件将在这里显示。

2. <script> 部分

export default {
  name: 'App', // 为组件指定一个名称
  data() {
    return {
      // 这里可以定义组件的数据
    };
  },
  methods: {
    // 这里可以定义组件的方法
  },
  mounted() {
    // 这里可以定义组件的生命周期钩子函数
  }
};

• export default { ... }：这是一个对象，用于定义组件的选项。

• name: 'App'：为组件指定一个名称，便于调试和识别。

• data()：这是一个函数，用于返回组件的数据对象。在这个例子中，没有定义任何数据。

• methods：这是一个对象，用于定义组件的方法。在这个例子中，没有定义任何方法。

• mounted()：这是一个生命周期钩子函数，在组件挂载到 DOM 后调用。在这个例子中，没有定义任何在挂载时执行的逻辑。

3. <style> 部分

/* 这里可以定义组件的样式 */

• 可以在这里定义组件的样式。可以使用 CSS、Sass、Less 等预处理器来编写样式。通常，全局样式会在 main.js 中引入，而 App.vue 中的样式主要用于组件自身的样式定义。

四、总结

• App.vue 文件是 Vue2 项目中的重要组成部分，它定义了应用的根组件，包含了应用的布局结构和一些全局的逻辑。通过理解和修改 App.vue 文件，可以实现对应用的整体布局和行为的控制。

• <template> 部分：定义了应用的根容器和路由视图，<router-view/> 是路由组件的展示区域。

• <script> 部分：定义了组件的基本选项，包括名称、数据、方法和生命周期钩子。可以根据需要扩展数据和逻辑。

• <style> 部分：定义了组件的样式，通常用于组件自身的样式定义，全局样式建议在 main.js 中引入。

通过 App.vue 文件，开发者可以控制应用的整体结构和行为，结合 Vue Router 和 Vuex，实现复杂的单页应用（SPA）功能。
18 - 登录模块商城用户端

一、引言

在 Vue2 项目中，登录模块是一个重要的组成部分，用于验证用户身份并提供访问权限。本实验手册将详细介绍一个基于 Vue2 的登录模块的代码结构和功能实现。

二、代码设计

登录模块的代码主要分布在 .vue 文件的 <template>、<script> 和 <style> 三个部分。

1. <template> 部分代码如下：

<template>
  <div class="login-info">
    <template v-if="login">
      <el-card class="login-info-form">
        
        <div class="login-header">商城用户登录</div>
        <el-form class="form-panel" :model="form" :rules="rules" ref="form">
          <el-form-item prop="username">
            <el-input v-model="form.username" placeholder="用户账号" clearable maxlength="20" show-word-limit></el-input>
          </el-form-item>
          <el-form-item prop="password">
            <el-input v-model="form.password" placeholder="用户密码" type="password" clearable maxlength="8" show-word-limit></el-input>
          </el-form-item>
          <el-form-item>
            <el-button style="width: 100%;" type="primary" @click="goLogin">登录</el-button>
            <el-button type="text" @click="changeLogin(false, true)">前往注册</el-button>
          </el-form-item>
        </el-form>
      </el-card>
    </template>
    <template v-if="register">
      <el-card class="login-info-form">
        
        <div class="login-header">商城用户注册</div>
        <el-form class="form-panel" :model="form" :rules="rules" ref="form">
          <el-form-item prop="username">
            <el-input v-model="form.username" placeholder="用户账号" clearable maxlength="20" show-word-limit></el-input>
          </el-form-item>
          <el-form-item prop="password">
            <el-input v-model="form.password" placeholder="用户密码" type="password" clearable maxlength="8" show-word-limit></el-input>
          </el-form-item>
          <el-form-item prop="confirmPassword">
            <el-input v-model="form.confirmPassword" placeholder="确认密码" type="password" clearable maxlength="8" show-word-limit></el-input>
          </el-form-item>
          <el-form-item>
            <el-button style="width: 100%;" type="primary" @click="goRegister">注册并登录</el-button>
            <el-button type="text" @click="changeLogin(true, false)">已有账号</el-button>
          </el-form-item>
        </el-form>
      </el-card>
    </template>
    <div class="login-back">
      <el-button type="text" @click="goAdmin">前往商城后台</el-button>
    </div>
  </div>
</template>


整体结构：

1. 登录模块（当 login 为 true 时显示）
2. 注册模块（当 register 为 true 时显示）
3. 前往商城后台按钮

使用的组件：

1. el-card：用于创建卡片样式的容器，分别包裹登录和注册表单。
2. img：用于显示商城 logo。
3. el-form：表单组件，用于收集用户输入的数据，并进行验证。
4. el-form-item：用于包裹表单中的单个输入项。
5. el-input：输入框组件，用于接收用户输入的用户名、密码和确认密码等信息。
6. el-button：按钮组件，分别用于登录、前往注册、注册并登录、已有账号以及前往商城后台等操作。

绑定的事件：

1. 在登录模块中：
   • @click="goLogin"：绑定在登录按钮上，点击时触发 goLogin 方法。

   • @click="changeLogin(false, true)"：绑定在前往注册按钮上，点击时触发 changeLogin 方法并传入参数 false 和 true。

2. 在注册模块中：
   • @click="goRegister"：绑定在注册并登录按钮上，点击时触发 goRegister 方法。

   • @click="changeLogin(true, false)"：绑定在已有账号按钮上，点击时触发 changeLogin 方法并传入参数 true 和 false。

3. @click="goAdmin"：绑定在前往商城后台按钮上，点击时触发 goAdmin 方法。

2. <script> 部分代码如下：

<script>
import { shoppingLogin, shoppingLogout, register } from "../../service/api.js";

export default {
  name: "login",
  data() {
    return {
      login: true,
      register: false,
      form: {
        username: "",
        password: "",
        confirmPassword: "",
      },
      rules: {
        username: [
          { required: true, message: "请输入用户账号", trigger: "blur" },
        ],
        password: [
          { required: true, message: "请输入用户密码", trigger: "blur" },
        ],
        confirmPassword: [
          { required: true, message: "请输入确认密码", trigger: "blur" },
        ],
      },
    };
  },
  methods: {
    goAdmin() {
      window.location.href = '/admin/login/logout';
    },
    async goRegister() {
      this.$refs.form.validate(async (valid) => {
        if (valid) {
          if (this.form.password !== this.form.confirmPassword) {
            this.$message.error("密码不一致，请重新输入");
            this.form.password = "";
            this.form.confirmPassword = "";
            return;
          }
          try {
            // 注册操作
            await register({
              username: this.form.username,
              password: this.form.password,
              confirmPassword: this.form.confirmPassword,
            });
            // 登录操作
            const res = await shoppingLogin({
              username: this.form.username,
              password: this.form.password,
            });
            this.$store.commit("setUsername", this.form.username);
            this.$store.commit("setLoginStatus", true);
            this.$store.commit("setToken", res.data);
            this.$store.commit("setLoginType", "shopping");
            this.login = false;
            this.register = false;
            this.$message.success("注册并登录成功");
            window.location.href = "/shopping/list";
          } catch (error) {
            this.$message.error(error);
          }
        }
      });
    },
    changeLogin(b1, b2) {
      this.login = b1;
      this.register = b2;
    },
    async goLogin() {
      this.$refs.form.validate(async (valid) => {
        if (valid) {
          try {
            // 登录操作
            const res = await shoppingLogin({
              username: this.form.username,
              password: this.form.password,
            });
            this.$store.commit("setUsername", this.form.username);
            this.$store.commit("setLoginStatus", true);
            this.$store.commit("setToken", res.data);
            this.$store.commit("setLoginType", "shopping");
            this.login = false;
            this.register = false;
            this.$message.success("登录成功");
            window.location.href = "/shopping/list";
          } catch (error) {
            this.$message.error(error);
          }
        }
      });
    },
  },
  async created() {
    // 获取路由中的参数(登出参数)
    if (this.$route.params.loginStatus === "logout") {
      // 请求退出登录
      await shoppingLogout({});
      // 清除本地存储
      window.localStorage.clear();
      // 清除 Vuex 中的登录状态
      this.$store.commit("setLoginStatus", false);
      return;
    }
    // 初始登出状态
    const loginStatus = this.$store.state.loginStatus;
    if (loginStatus) {
      this.login = false;
      this.register = false;
      window.alert("您已经是登录状态");
      window.location.href = "/shopping/list";
    }
  },
};
</script>


引入相关模块：

• import { shoppingLogin, shoppingLogout, register } from "../../service/api.js";：引入用于登录、注销和注册的 API 方法。

定义组件选项：

• export default { ... }：定义组件的选项对象。

• name: "login"：为组件指定名称。

• data()：返回组件的数据对象。

  • login: true：初始状态为登录表单显示。

  • register: false：初始状态为注册表单不显示。

  • form：包含用户名、密码和确认密码的对象，用于表单数据绑定。

  • rules：表单的验证规则对象。

• methods：定义组件的方法。

  • goAdmin()：点击前往商城后台按钮时触发，通过修改 window.location.href 实现页面跳转。

  • goRegister()：点击注册并登录按钮时触发，进行表单验证，调用注册 API 和登录 API，并根据结果进行相应的操作，如提交成功后跳转到商品列表页面，并显示成功消息。

  • changeLogin(b1, b2)：用于切换登录和注册表单的显示状态。

  • goLogin()：点击登录按钮时触发，进行表单验证，调用登录 API，并根据结果进行相应的操作，如提交成功后跳转到商品列表页面，并显示成功消息。

  • async created()：组件创建时执行的生命周期钩子函数。

    ◦ 根据路由参数判断是否为登出状态，如果是，则调用退出登录 API，清除本地存储和 Vuex 中的登录状态。

    ◦ 如果不是登出状态，则根据 Vuex 中的登录状态判断是否已经登录，如果已登录则跳转到商品列表页面并提示已登录状态。

3. <style scoped> 部分代码如下：

<style scoped>
.login-info {
  height: 100vh;
  width: 100vw;
  text-align: center;
  background-image: url("@/assets/login/login-bg.jpg");
  background-size: 100% 100%;
}
.shopping-logo {
  width: 128px;
  height: 128px;
}
.login-header {
  font-size: 32px;
  font-weight: 600;
  color: #5c6b77;
  margin-bottom: 20px;
}
.login-info-form {
  width: 500px;
  height: 500px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.form-panel {
  margin-left: 40px;
  margin-right: 40px;
}
.login-back {
  position: absolute;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
}
</style>


总结

本章节详细介绍了商城用户端登录模块的代码结构和功能实现。通过 <template>、<script> 和 <style> 三个部分的代码，实现了用户登录、注册、以及前往商城后台的功能。登录模块通过表单验证、API 调用和状态管理，确保用户身份验证的安全性和有效性。后续可以在该模块的基础上，进一步扩展功能，如忘记密码、第三方登录等。